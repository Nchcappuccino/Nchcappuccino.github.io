---
layout: post
title:  "ロボコンでよく使われるパーツ センサー編"
# summary: ""
author: yamaguchi
date: '2021-03-04 00:00:00 +0900'
category: ['入門','パーツ紹介']
usemathjax: false
permalink: /blog/2021-03-04/
---
# ロボコンでよく使われるパーツ センサー編
このブログを書いてる時刻が3月3日の21:32分です。 
世間はひな祭りらしいですね。僕は[ときのそらの新衣装お披露目配信](https://www.youtube.com/watch?v=f6ZtHsHHTvA&ab_channel=SoraCh.%E3%81%A8%E3%81%8D%E3%81%AE%E3%81%9D%E3%82%89%E3%83%81%E3%83%A3%E3%83%B3%E3%83%8D%E3%83%AB)を見て知りました()  
配信の内容は最高でした。

強引な布教してすみませんw   
# 内容
今回の内容はセンサー編ですが、センサーと言っても大きく分けて
- センサーから出力される電圧をマイコンで読み取る方式
- センサーとマイコンでSPIやI2Cなどを用いて通信をしてセンサーの値を取得する方式 

の2種類のデータの取得方法があります。  
UARTやI2Cは通信方式のことです。これらの通信方式が何か分からない方もいるとは思いますが、今は通信に関係する何かなんだなくらいのイメージで大丈夫です。
# 距離センサー
距離センサーとか距離を計測するセンサーですが大きく分けて
- 超音波を出力して、超音波の返ってくる時間を計測する超音波センサー
- 赤外線を出力して、赤外線の帰ってくる時間を計測するToFセンサー
- ToFセンサーを発展させたLidarセンサー

があります。
### 超音波センサー
超音波センサーは2つあるでっぱりの片方から超音波を出力して、もう片方で超音波を受信します。(下の画像参照)      
中学校で習った通り、音は**約**340m/sで進むことを利用して、対象の物体に超音波を当てて、返ってくるまでの時間を計測することで距離を割り出しています。    
ただ、音は340m/sで進むので遅いです。つまり距離の計測に時間がかかります。    
指向性が悪いため精度もあまり出ないので、ロボコンでは採用される機会は少ないです。  

代表的な物としては[HCSR04](https://akizukidenshi.com/catalog/g/gM-11009/)があります。  
利点は安いことくらい。  
![HCSR04](/assets/img/posts/20210304/hcsr04.jpg)  

### ToFセンサー  
ToFセンサーは超音波センサーと違い、赤外線を出力するので計測時間も短いだけでなく、指向性が高いゆえに精度も高いです。  
ロボコンだけでなく、ドローンや車の自動運転などにも採用される今注目されている技術です。  
センサーの出力はI2Cで取得したデータを吐き出すのが主流です。  

I2Cなどで通信をする必要のあるセンサーはToFセンサーのように高性能なセンサーに使われることがほとんどです。その分値段は、電圧でセンサーの値が読める物と比べると高いです。  

ToFセンサー代表的なものとしてはVLシリーズです。  
![ToF_VL](/assets/img/posts/20210304/tof_vl.jpg)  
https://store.shopping.yahoo.co.jp/suzakulab/pololu-3415.html
https://store.shopping.yahoo.co.jp/suzakulab/Pololu-2489.html  
この2つは性能は全く異なるものの外形が一緒なので、扱いが楽です。  

ちなみにですが、このToFセンサーのようにPololuから発売されてるセンサーはいろいろと素晴らしいのでおすすめです。  

### Lidarセンサー
LidarセンサーはToFセンサーを応用させたセンサーで、全方位の正確な距離の計測が可能です。     
ただ、扱うには難しい数学の知識などが必要になるので今回は割愛します。  
# ジャイロセンサー  
ジャイロセンサーとは別名角速度センサーと呼ばれ、角速度を検出するデバイスのことです。  
角速度を積分して角度を検出することができます。  
ジャイロセンサーについて分かりやすいブログを乗っけておくので、必ず読んでみてください。  
https://garchiving.com/angular-from-angular-acceleration/  

### 原理
原理というかジャイロセンサーを理解するための説明です。  

##### What is 角速度
角速度というのが何か分からない人がほとんどだと思うのでまずはそこから説明します。  
角速度とは単位時間あたりに回転した角度のことで、  
1秒後に30度の角度であれば角速度は30deg/sで、10秒後に50度の角度であれば5deg/sになります。 
ちなみに1秒後に-30度の角度であれば角速度は-30deg/sになります。 
##### 角速度からどうやって角度をもとめるの？
上のリンクのブログでも説明されてるように、角速度に角速度を検出する時間の間隔(dt)を掛けて足し続けると角度をもとめることができます。  
プログラムではこれが**積分**という処理に当たります。  
ただ数字を足すだけの簡単な処理です。  


ここら辺はいろいろ難しいので、最初は分からいのが当然だと思います。
**分からないときは分からない単語を調べて理解する、それでも理解できなかったら詳しそうな人に聞くようにしましょう。**  

### 代表的なもの
これに関してはいろいろ種類があるので僕の意見になってしまいますが、[MPU6050](www.amazon.co.jp/dp/B008BOPN40)、[MPU9250](www.amazon.co.jp/dp/B0154PM102)、[BNO055](https://www.switch-science.com/catalog/5511/)かなと思ってます。  
**これらのセンサーはArduinoのライブラリが充実してるのとネットに情報もたくさん集まっているので知識がなくても使えます。(ここ大事)**
##### MPU6050
![MPU6050](/assets/img/posts/20210304/mpu6050.jpg)
- 安い  
- 簡単な上に超高性能
- 特にデメリットのないバランスの取れたセンサー
##### MPU9250
![MPU9250](/assets/img/posts/20210304/mpu9250.jpg)
- MPU6050の上位互換だが、その分いい値段する
- クオータニオンといういろいろ補正されたデータを出力してくれる
- SPIでも通信できる
- **現在製造されてない(ディスコン)。Amazonとかに在庫はたくさんあるからしばらくは気にしなくていい**
##### BNO055
![BNO055](/assets/img/posts/20210304/BNO055.jpg)
- 高い
- こちらもクオータニオンを出力してくれる
- ちゃんと使ったことないから詳しいことはわかんない、ごめんなさい！！！

僕はMPU9250を使ってます。   
使ってる理由に特に深い意味はないです()  

ちなみにジャイロセンサーもセンサーの内部で高度な計算を行っているのでマイコンと通信してセンサーの値を得る方式が普通です。

# エンコーダ
エンコーダとはロボットがどこにいるかを判断するのに使う道具です。ちなみにロボットがどこにいるかを判断することを**自己位置推定**や**オドメドリ**と言います。  
### 原理
こちらの資料をみていただければわかりやすいです。**必ず読んでください！**  
原理だけでなく自己位置推定の方法も記されているのでちょっと長いけどかなり参考になります。   
https://github.com/Nchcappuccino/Nchcappuccino.github.io/tree/master/assets/download/encoder_kit06_kaisetsu.pdf
エンコーダはロボコンでは2相か3相のものが主流で、このように配置されることが多いです。
### 代表的なもの
エンコーダはロボコンでは[AMT102](https://www.mouser.jp/ProductDetail/CUI-Devices/AMT102-V/?qs=WyjlAZoYn533PQfgnorrMg==)が主流です。  
方式としては、インクリメンタル方式を応用したもので、原点信号と呼ばれるZ相が存在してるので疑似アブソリュート方式と呼ばれる方式に該当します。ちなみにZ相のZはZeroの意味らしい。    
機械側がモータの軸にぶっさすだけでエンコーダが使えるのが特徴。  
だた、電源電圧が5Vなのが欠点。  

京大の2019のロボットのエンコーダは[AMT203](https://www.digikey.jp/product-detail/ja/cui-devices/AMT203-V/102-2050-ND/2278846)を使ってるらしいです。  
SPIでカウントできるのが特徴。
http://kikaiken.blogspot.com/2019/10/nhkabu2019.html

ちなみに、ロボ研では自作磁器エンコーダを使ってます。安い分、機械の人の手間が増えます()  

# カメラ
カメラはOpenCVを用いて画像解析に使われます。    
ロボコンでは[D435](https://www.switch-science.com/catalog/3633/)という最強のパソコンに最強のカメラの搭載されたものが使われる気がします(語彙力)    
RCJだと、[Pixy2](https://www.switch-science.com/catalog/3905/)や[OpenMV](https://www.switch-science.com/catalog/5537/)が多く使われます。サイズが小さい分、性能はD435とかに比べると大きく劣ります。  

# 次回
次回はコネクタ編です。  
内容が明らかに入門ではない気がしますが、こんなパーツがロボコンでは使われてるんだなーくらいに理解してもらえれば大丈夫です。  

# おまけ
細かい通信の方式については今後解説するんですけど、I2Cは**アイ・スクエアド・シーやアイ・ツー・シー**と読みます。  
僕は周りの人間が前者の読み方をしてるんで合わせていますが、本当は後者の読み方が好きです。